name: Workflow

on:
  push:
    branches:
      - feat-devsecops

jobs:
  SAST:
    runs-on: ubuntu-latest
    steps:
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: "17"
          distribution: "adopt"

      - name: Checkout code
        uses: actions/checkout@v2

      # - name: Validate Project on SonarCloud
      #   env:
      #     SONAR_TOKEN: "${{ secrets.SONAR_TOKEN }}"
      #   run: |
      #     set +e
      #     curl -f -X POST -u '${{ secrets.SONAR_TOKEN }}:' 'https://sonarcloud.io/api/projects/create' \
      #       -d "name=${{ github.event.repository.name }}" \
      #       -d "project=${{ github.event.repository.name }}" \
      #       -d "organization=devsecops7" \
      #       -d "visibility=public"
      #     if [ $? -ne 0 ]; then
      #       echo "No se puede crear el proyecto en SonarCloud"
      #     else
      #       echo "El Proyecto ${{ github.event.repository.name }} fue creado exitosamente en SonarCloud"
      #       echo "Estableciendo la rama main como rama por defecto"
      #       curl -X POST -u '${{ secrets.SONAR_TOKEN }}:' 'https://sonarcloud.io/api/project_branches/rename' \
      #         -d "name=main" \
      #         -d "project=${{ github.event.repository.name }}"
      #     fi

      # - name: Run SonarCloud Scan
      #   env:
      #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      #   run: |
      #     npx sonar-scanner \
      #       -Dsonar.organization=devsecops7 \
      #       -Dsonar.projectKey= ${{ github.event.repository.name }} \
      #       -Dsonar.host.url=https://sonarcloud.io \
      #       -Dsonar.login=${{ secrets.SONAR_TOKEN }}

  #------------SCA-----------------

  SCA:
    needs: SAST
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: build
        run: |
          chmod 777 package.json
          ./package.json
